# 在庫管理画面設計書

## 目次
- [1. 基本情報](#1-基本情報)
- [2. 画面概要](#2-画面概要)
- [3. UI要素一覧](#3-ui要素一覧)
- [4. 機能仕様](#4-機能仕様)
- [5. バリデーション](#5-バリデーション)
- [6. セキュリティ](#6-セキュリティ)
- [7. レイアウト](#7-レイアウト)
- [8. 使用技術](#8-使用技術)
- [9. データ仕様](#9-データ仕様)

---

## 1. 基本情報

| 項目 | 内容 |
|------|------|
| 画面ID | INV-001 |
| 画面名 | 在庫管理画面 |
| URL | /inventory |
| アクセス権限 | 認証済みユーザー（一般ユーザー・管理者） |
| 作成日 | 2026年2月4日 |
| 更新日 | 2026年2月4日 |

---

## 2. 画面概要

商品の在庫状況をリアルタイムで確認し、入庫・出庫の管理を行うための画面です。在庫不足商品のアラート表示、検索・フィルタリング機能、在庫数の更新機能を提供し、効率的な在庫管理を実現します。

### 主な機能
- 在庫状況のリアルタイム表示
- 在庫不足アラートの表示
- 商品の検索・フィルタリング
- 在庫数の入庫・出庫管理
- 商品詳細へのアクセス

---

## 3. UI要素一覧

### 3.1 ナビゲーションバー

| No | 要素種別 | 項目名 | 入力形式 | 必須/任意 | 備考 |
|----|----------|--------|----------|-----------|------|
| 1 | ロゴ/リンク | システム名 | link | - | 「商品在庫管理システム」<br>/menuへ遷移 |
| 2 | ナビゲーションリンク | パスワード変更 | link | - | /users/passwordへ遷移<br>アイコン：bi-key |
| 3 | ボタン | ログアウト | submit | - | /logoutへPOST送信<br>アイコン：bi-box-arrow-right |

### 3.2 ページヘッダー

| No | 要素種別 | 項目名 | 入力形式 | 必須/任意 | 備考 |
|----|----------|--------|----------|-----------|------|
| 4 | 見出し | ページタイトル | - | - | 「在庫管理」<br>アイコン：bi-clipboard-data |

### 3.3 在庫不足アラート

| No | 要素種別 | 項目名 | 入力形式 | 必須/任意 | 備考 |
|----|----------|--------|----------|-----------|------|
| 5 | アラート | 在庫不足通知 | alert-warning | - | 在庫不足・在庫切れ商品数を表示<br>アイコン：bi-exclamation-triangle-fill<br>在庫不足：20個以下<br>在庫切れ：0個 |

### 3.4 検索・フィルタリングパネル

| No | 要素種別 | 項目名 | 入力形式 | 必須/任意 | 備考 |
|----|----------|--------|----------|-----------|------|
| 6 | 入力欄 | 商品名検索 | text | 任意 | プレースホルダー：「商品名を入力」<br>部分一致検索 |
| 7 | セレクトボックス | カテゴリフィルタ | select | 任意 | オプション：全て、Electronics、Clothing、Home Appliances |
| 8 | セレクトボックス | ステータスフィルタ | select | 任意 | オプション：全て、販売中(active)、販売停止(inactive) |
| 9 | セレクトボックス | 在庫状態フィルタ | select | 任意 | オプション：全て、在庫あり(21個以上)、在庫不足(1-20個)、在庫なし(0個) |
| 10 | セレクトボックス | 並び順 | select | 任意 | オプション：商品名順、在庫数順、更新日順<br>デフォルト：商品名順 |
| 11 | ボタン | 検索ボタン | submit | - | 検索実行<br>アイコン：bi-search<br>スタイル：btn-primary |
| 12 | ボタン | クリアボタン | reset | - | フォームリセット<br>アイコン：bi-x-circle<br>スタイル：btn-secondary |

### 3.5 商品一覧テーブル

| No | 要素種別 | 項目名 | 入力形式 | 必須/任意 | 備考 |
|----|----------|--------|----------|-----------|------|
| 13 | テーブルヘッダー | 商品コード | - | - | 幅：10%<br>固定幅レイアウト |
| 14 | テーブルヘッダー | 商品名 | - | - | 幅：20% |
| 15 | テーブルヘッダー | カテゴリ | - | - | 幅：15% |
| 16 | テーブルヘッダー | 価格 | - | - | 幅：10% |
| 17 | テーブルヘッダー | 在庫数 | - | - | 幅：10% |
| 18 | テーブルヘッダー | ステータス | - | - | 幅：12% |
| 19 | テーブルヘッダー | 更新日 | - | - | 幅：13% |
| 20 | テーブルヘッダー | 詳細 | - | - | 幅：10% |
| 21 | テーブルセル | 商品コード表示 | code | - | `<code>`タグで表示 |
| 22 | テーブルセル | 商品名表示 | text | - | 通常テキスト |
| 23 | テーブルセル | カテゴリ表示 | badge | - | Badgeで表示<br>Electronics：bg-primary<br>Clothing：bg-info<br>Home Appliances：bg-secondary |
| 24 | テーブルセル | 価格表示 | text | - | ¥表記<br>整数表示 |
| 25 | テーブルセル/リンク | 在庫数表示 | link/text | - | 0個：下線付きリンク（モーダル起動）<br>1-20個：下線付きリンク（モーダル起動）<br>21個以上：通常テキスト（stock-okクラス） |
| 26 | テーブルセル | ステータス表示 | badge | - | 販売中：badge-status-active<br>販売停止：badge-status-inactive |
| 27 | テーブルセル | 更新日表示 | text | - | YYYY-MM-DD形式 |
| 28 | テーブルセル/ボタン | 詳細ボタン | button | - | /products/{商品ID}へ遷移<br>アイコン：bi-eye<br>スタイル：btn-sm btn-outline-primary |
| 29 | テーブル行 | 商品行 | - | - | クリック可能（product-rowクラス）<br>onclick時に商品詳細へ遷移 |

### 3.6 ページネーション

| No | 要素種別 | 項目名 | 入力形式 | 必須/任意 | 備考 |
|----|----------|--------|----------|-----------|------|
| 30 | リンク | 最初のページ | link | - | 最初のページへ遷移<br>アイコン：bi-chevron-double-left |
| 31 | リンク | 前のページ | link | - | 前のページへ遷移<br>アイコン：bi-chevron-left |
| 32 | リンク | ページ番号 | link | - | 各ページへ遷移<br>現在ページは「active」クラス |
| 33 | リンク | 次のページ | link | - | 次のページへ遷移<br>アイコン：bi-chevron-right |
| 34 | リンク | 最後のページ | link | - | 最後のページへ遷移<br>アイコン：bi-chevron-double-right |
| 35 | テキスト | ページ情報 | text | - | 「全X件中 Y-Z件を表示 (ページ N/M)」 |

### 3.7 入庫・出庫モーダル

| No | 要素種別 | 項目名 | 入力形式 | 必須/任意 | 備考 |
|----|----------|--------|----------|-----------|------|
| 36 | モーダルヘッダー | タイトル | - | - | 「在庫管理」 |
| 37 | ラジオボタン | 操作選択：入庫 | radio | 必須 | name：stockOperation<br>value：in<br>デフォルト：選択済み |
| 38 | ラジオボタン | 操作選択：出庫 | radio | 必須 | name：stockOperation<br>value：out |
| 39 | 入力欄 | 在庫数入力 | number | 必須 | プレースホルダー：「在庫数」<br>数値のみ入力可能 |
| 40 | ボタン | 更新ボタン | submit | - | 在庫更新処理を実行<br>スタイル：btn-primary |
| 41 | ボタン | 閉じるボタン | button | - | モーダルを閉じる<br>スタイル：btn-secondary |

---

## 4. 機能仕様

### 4.1 画面表示機能

#### 4.1.1 在庫一覧表示
- **処理概要**：登録されている商品の在庫情報を一覧表示
- **表示項目**：商品コード、商品名、カテゴリ、価格、在庫数、ステータス、更新日
- **表示順**：デフォルトは商品名昇順
- **ページング**：1ページあたり20件表示
- **在庫数表示ルール**：
  - 0個：在庫切れ（リンク表示、モーダル起動可能）
  - 1-20個：在庫不足（リンク表示、モーダル起動可能）
  - 21個以上：在庫十分（通常テキスト表示）

#### 4.1.2 在庫不足アラート表示
- **表示条件**：在庫不足（20個以下）または在庫切れ（0個）の商品が存在する場合
- **表示内容**：
  - 在庫不足商品数（1-20個の商品数）
  - 在庫切れ商品数（0個の商品数）
- **スタイル**：alert-warning（黄色背景）
- **アイコン**：bi-exclamation-triangle-fill

### 4.2 検索・フィルタリング機能

#### 4.2.1 商品名検索
- **検索方式**：部分一致検索
- **対象項目**：商品名
- **大文字小文字**：区別しない
- **動作**：検索ボタン押下時に実行

#### 4.2.2 カテゴリフィルタ
- **選択肢**：全て、Electronics、Clothing、Home Appliances
- **動作**：選択したカテゴリの商品のみ表示
- **デフォルト**：全て

#### 4.2.3 ステータスフィルタ
- **選択肢**：全て、販売中(active)、販売停止(inactive)
- **動作**：選択したステータスの商品のみ表示
- **デフォルト**：全て

#### 4.2.4 在庫状態フィルタ
- **選択肢**：
  - 全て：全商品を表示
  - 在庫あり(21個以上)：sufficient
  - 在庫不足(1-20個)：low
  - 在庫なし(0個)：out
- **動作**：選択した在庫状態の商品のみ表示
- **デフォルト**：全て

#### 4.2.5 並び順
- **選択肢**：
  - 商品名順：name（昇順）
  - 在庫数順：stock（昇順）
  - 更新日順：updated（降順）
- **デフォルト**：商品名順

#### 4.2.6 クリア機能
- **動作**：全ての検索・フィルタ条件をリセット
- **実行方法**：クリアボタン押下

### 4.3 入庫・出庫管理機能

#### 4.3.1 モーダル起動
- **起動条件**：在庫数リンク（0個または1-20個）をクリック
- **表示内容**：
  - 操作選択（入庫/出庫）
  - 在庫数入力欄
  - 更新ボタン
  - 閉じるボタン

#### 4.3.2 入庫処理
- **処理概要**：現在の在庫数に入力値を加算
- **計算式**：新在庫数 = 現在の在庫数 + 入力値
- **制約**：入力値は正の整数のみ
- **処理後**：
  - 在庫数を更新
  - 更新日を現在日時に更新
  - 在庫履歴テーブル(stock_transactions)に入庫記録を追加
  - モーダルを閉じて一覧画面をリフレッシュ

#### 4.3.3 出庫処理
- **処理概要**：現在の在庫数から入力値を減算
- **計算式**：新在庫数 = 現在の在庫数 - 入力値
- **制約**：
  - 入力値は正の整数のみ
  - 新在庫数が負にならないこと（現在の在庫数以下の値のみ入力可能）
- **処理後**：
  - 在庫数を更新
  - 更新日を現在日時に更新
  - 在庫履歴テーブル(stock_transactions)に出庫記録を追加
  - モーダルを閉じて一覧画面をリフレッシュ

### 4.4 画面遷移機能

#### 4.4.1 商品詳細への遷移
- **遷移方法**：
  - テーブル行クリック
  - 詳細ボタンクリック
- **遷移先**：/products/{商品ID}
- **データ引継ぎ**：商品IDをURLパラメータとして渡す

#### 4.4.2 ナビゲーション
- **システム名クリック**：/menuへ遷移（メインメニュー画面）
- **パスワード変更リンク**：/users/passwordへ遷移
- **ログアウトボタン**：/logoutへPOST送信後、ログイン画面へ遷移

### 4.5 ページング機能

#### 4.5.1 ページネーション
- **1ページあたりの表示件数**：20件
- **ページ番号表示**：現在ページの前後各2ページ + 最初/最後のページ
- **省略表示**：ページ数が多い場合は「...」で省略
- **現在ページ表示**：activeクラスでハイライト
- **ページ情報表示**：「全X件中 Y-Z件を表示 (ページ N/M)」

#### 4.5.2 ページ遷移
- **最初のページ**：1ページ目へ遷移（現在1ページ目の場合は非活性）
- **前のページ**：前のページへ遷移（現在1ページ目の場合は非活性）
- **ページ番号**：指定ページへ遷移
- **次のページ**：次のページへ遷移（現在最終ページの場合は非活性）
- **最後のページ**：最終ページへ遷移（現在最終ページの場合は非活性）

---

## 5. バリデーション

### 5.1 入庫・出庫入力バリデーション

| 項目 | バリデーション内容 |
|------|-------------------|
| 操作選択 | ・入庫または出庫のいずれかを選択必須 |
| 在庫数入力 | ・必須入力<br>・数値のみ入力可能<br>・正の整数のみ（1以上）<br>・最大値：999,999<br>・出庫の場合：現在の在庫数以下の値のみ入力可能 |

### 5.2 検索・フィルタバリデーション

| 項目 | バリデーション内容 |
|------|-------------------|
| 商品名検索 | ・任意入力<br>・最大文字数：100文字<br>・特殊文字入力可能 |
| カテゴリフィルタ | ・選択式（バリデーション不要） |
| ステータスフィルタ | ・選択式（バリデーション不要） |
| 在庫状態フィルタ | ・選択式（バリデーション不要） |
| 並び順 | ・選択式（バリデーション不要） |

### 5.3 エラーメッセージ

| エラー種別 | メッセージ内容 |
|-----------|---------------|
| 在庫数未入力 | 「在庫数を入力してください。」 |
| 在庫数が数値でない | 「在庫数は数値で入力してください。」 |
| 在庫数が負の値 | 「在庫数は正の値で入力してください。」 |
| 在庫数が最大値超過 | 「在庫数は999,999以下で入力してください。」 |
| 出庫数が在庫数超過 | 「出庫数は現在の在庫数（X個）以下で入力してください。」 |
| 検索条件エラー | 「検索条件を正しく入力してください。」 |
| システムエラー | 「システムエラーが発生しました。管理者に連絡してください。」 |

---

## 6. セキュリティ

### 6.1 認証・認可

| 項目 | 対策内容 |
|------|---------|
| 認証 | ・ログイン認証必須<br>・未認証ユーザーはログイン画面へリダイレクト |
| セッション管理 | ・Spring Securityによるセッション管理<br>・セッションタイムアウト：30分 |
| CSRF対策 | ・全てのPOSTリクエストでCSRFトークン検証を実施<br>・ログアウト処理にもCSRF保護を適用 |

### 6.2 入力値検証

| 項目 | 対策内容 |
|------|---------|
| XSS対策 | ・Thymeleafのエスケープ機能を使用<br>・ユーザー入力値を全てエスケープ処理 |
| SQLインジェクション対策 | ・PreparedStatementを使用<br>・JPAのパラメータバインディングを使用 |
| パラメータ改ざん対策 | ・サーバーサイドでの入力値検証を実施<br>・不正な値が入力された場合はエラーを返す |

### 6.3 データ保護

| 項目 | 対策内容 |
|------|---------|
| 通信暗号化 | ・HTTPS通信を推奨<br>・本番環境ではHTTPSを必須とする |
| ログ記録 | ・在庫変更履歴をstock_transactionsテーブルに記録<br>・誰がいつ何をしたかを追跡可能にする |

---

## 7. レイアウト

### 7.1 画面構成

```
+--------------------------------------------------+
| ナビゲーションバー (固定)                           |
| [商品在庫管理システム]    [パスワード変更] [ログアウト] |
+--------------------------------------------------+
| メインコンテンツエリア                              |
|   [在庫管理]                                       |
|   +----------------------------------------------+ |
|   | 在庫不足アラート                                | |
|   +----------------------------------------------+ |
|   +----------------------------------------------+ |
|   | 検索・フィルタリングパネル                        | |
|   | [商品名] [カテゴリ] [ステータス] [在庫状態] [並び順] | |
|   | [検索] [クリア]                                 | |
|   +----------------------------------------------+ |
|   +----------------------------------------------+ |
|   | 商品一覧テーブル                                | |
|   | ID | 商品名 | カテゴリ | 価格 | 在庫 | ... | |
|   | -------------------------------------------- | |
|   | 商品データ行...                                 | |
|   +----------------------------------------------+ |
|   +----------------------------------------------+ |
|   | ページネーション                                | |
|   | [<<] [<] [1] [2] [3] ... [>] [>>]           | |
|   +----------------------------------------------+ |
+--------------------------------------------------+
```

### 7.2 レスポンシブデザイン

- **Bootstrap 5.2.3**のグリッドシステムを使用
- **ブレークポイント**：
  - モバイル（< 768px）：縦スクロール、テーブルは横スクロール可能
  - タブレット（768px - 1024px）：2カラムレイアウト
  - デスクトップ（> 1024px）：フルレイアウト

### 7.3 カラースキーム

| 要素 | カラー/スタイル |
|------|---------------|
| 在庫切れ（0個） | テキストリンク（下線付き） |
| 在庫不足（1-20個） | テキストリンク（下線付き） |
| 在庫十分（21個以上） | 通常テキスト（stock-okクラス） |
| 販売中バッジ | badge-status-active（緑系） |
| 販売停止バッジ | badge-status-inactive（グレー系） |
| Electronicsバッジ | bg-primary（青） |
| Clothingバッジ | bg-info（水色） |
| Home Appliancesバッジ | bg-secondary（グレー） |
| 在庫不足アラート | alert-warning（黄色背景） |

### 7.4 アイコン使用

- **Bootstrap Icons 1.10.0**を使用
- 主要アイコン：
  - bi-clipboard-data：在庫管理
  - bi-exclamation-triangle-fill：警告
  - bi-search：検索
  - bi-x-circle：クリア
  - bi-eye：詳細表示
  - bi-chevron-left/right：ページ遷移
  - bi-chevron-double-left/right：最初/最後のページ

---

## 8. 使用技術

### 8.1 フロントエンド

| 技術 | バージョン | 用途 |
|------|----------|------|
| Thymeleaf | 3.x | テンプレートエンジン |
| Bootstrap | 5.2.3 | CSSフレームワーク |
| Bootstrap Icons | 1.10.0 | アイコンライブラリ |
| JavaScript | ES6+ | クライアントサイド処理 |

### 8.2 バックエンド

| 技術 | バージョン | 用途 |
|------|----------|------|
| Spring Boot | 3.x | アプリケーションフレームワーク |
| Spring Security | 6.x | 認証・認可 |
| Spring Data JPA | 3.x | データアクセス層 |
| Java | 17以上 | プログラミング言語 |

### 8.3 データベース

| 項目 | 内容 |
|------|------|
| RDBMS | PostgreSQL / MySQL / H2 |
| テーブル | products（商品マスタ）<br>stock_transactions（在庫変動履歴） |

---

## 9. データ仕様

### 9.1 表示データ構造

#### 商品情報（products）

| 項目名 | データ型 | 説明 |
|--------|---------|------|
| id | INT | AutoIncrement ID（主キー） |
| product_code | VARCHAR(8) | 商品コード（ユニーク） |
| product_name | VARCHAR(100) | 商品名 |
| category | VARCHAR(50) | カテゴリ |
| price | INTEGER | 価格（円） |
| stock_quantity | INTEGER | 在庫数 |
| status | VARCHAR(20) | ステータス（active/inactive） |
| updated_at | TIMESTAMP | 更新日時 |

#### 在庫変動履歴（stock_transactions）

| 項目名 | データ型 | 説明 |
|--------|---------|------|
| id | INT | AutoIncrement ID（主キー） |
| product_id | INT | 商品の内部ID（外部キー） |
| transaction_type | VARCHAR(10) | 取引種別（in/out） |
| quantity | INTEGER | 数量 |
| before_stock | INTEGER | 変更前在庫数 |
| after_stock | INTEGER | 変更後在庫数 |
| user_id | VARCHAR(50) | 実行ユーザーID |
| transaction_date | TIMESTAMP | 取引日時 |
| remarks | VARCHAR(255) | 備考 |

### 9.2 在庫状態の定義

| 状態 | 条件 | 表示スタイル |
|------|------|-------------|
| 在庫切れ | stock_quantity = 0 | リンク表示（モーダル起動可能） |
| 在庫不足 | 1 ≤ stock_quantity ≤ 20 | リンク表示（モーダル起動可能） |
| 在庫十分 | stock_quantity ≥ 21 | 通常テキスト |

### 9.3 ステータスの定義

| ステータス | 値 | 説明 |
|-----------|-----|------|
| 販売中 | active | 現在販売中の商品 |
| 販売停止 | inactive | 販売を停止している商品 |

---

## 10. 補足事項

### 10.1 パフォーマンス要件

- **ページ表示時間**：2秒以内
- **検索処理時間**：3秒以内
- **在庫更新処理時間**：2秒以内
- **同時アクセス数**：100ユーザー

### 10.2 今後の拡張案

#### フェーズ1（現在）
- 基本的な在庫表示・管理機能
- 検索・フィルタリング機能
- 入庫・出庫管理機能

#### フェーズ2（今後の拡張）
- **CSVエクスポート**：在庫一覧をCSV形式でダウンロード
- **在庫推移グラフ**：時系列での在庫変動をグラフ表示
- **在庫予測機能**：過去のデータから将来の在庫を予測
- **自動発注機能**：在庫が一定数を下回った際に自動発注
- **バーコード連携**：バーコードスキャンによる在庫管理
- **入出庫理由の記録**：入庫・出庫の理由を記録する機能
- **複数倉庫対応**：複数の倉庫の在庫を一元管理

### 10.3 既知の制約事項

- 在庫数の上限は999,999個
- 1ページあたりの表示件数は固定（20件）
- 検索条件は最大5項目まで
- モーダルでの在庫更新は1商品ずつのみ（一括更新は未対応）

### 10.4 関連画面

| 画面名 | URL | 関連性 |
|--------|-----|--------|
| 商品詳細画面 | /products/{商品ID} | 各商品行・詳細ボタンから遷移 |
| メインメニュー画面 | /menu | ナビゲーションバーから遷移 |
| パスワード変更画面 | /users/password | ナビゲーションバーから遷移 |
| ログイン画面 | /login | ログアウト後に遷移 |
