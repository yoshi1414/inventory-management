# 要件定義書

## 導入・全体概要

### システム化の背景・目的
現状の課題として、在庫管理や商品情報の管理が手作業で行われており、ミスや作業時間の増加が発生しています。本システムの導入により、これらの課題を解決し、業務効率化と正確性の向上を目指します。

### 目標（ゴール）
- 作業時間を30%削減。
- 在庫管理の正確性を95%以上に向上。
- 商品情報の検索・更新時間を50%短縮。

### 適用範囲（スコープ）
- **対象範囲**: 商品マスタ管理、在庫管理、ユーザー管理、認証機能。
- **対象外**: 財務管理、物流管理。

## 業務要件

### 業務フロー（現行・新）
- **現行フロー**: 商品情報や在庫状況をExcelで管理し、手動で更新。
- **新フロー**: システムを利用して商品情報や在庫状況を一元管理し、自動更新を実現。

### 利用者一覧
- **管理者**: 商品や在庫の登録・更新・削除、ユーザー管理を行う。
- **一般ユーザー**: 商品情報の閲覧、在庫状況の確認を行う。

### 業務シナリオ
1. **商品登録**: 管理者が新商品を登録し、在庫数を初期設定。
2. **在庫確認**: 一般ユーザーが在庫状況を確認し、必要に応じて管理者に補充を依頼。
3. **ユーザー管理**: 管理者が新規ユーザーを登録し、権限を設定。

## 必須機能

### 1. 商品マスタ管理
- **Create（登録）**
  - 商品名、カテゴリ、在庫数、ステータスを入力して新規商品を登録。
  - 入力フォームにバリデーションを実装（必須項目、形式チェック）。
- **Read（表示）**
  - 商品一覧を表示（ページネーション対応）。
  - カテゴリやステータスでのフィルタリング機能。
  - 商品詳細ページで個別の商品情報を確認可能。
- **Update（更新）**
  - 商品情報（名前、カテゴリ、在庫数、ステータス）の編集機能。
  - 編集時にバリデーションを再チェック。
- **Delete（削除）**
  - 商品の論理削除を実装（データベース上では削除フラグを設定）。
  - 削除済み商品の復元機能を追加。

### 2. 在庫管理
- **Create（登録）**
  - 入庫処理：商品ごとの入庫数を登録。
  - 出庫処理：商品ごとの出庫数を登録。
  - 入出庫時に履歴を自動記録。
- **Read（表示）**
  - 商品ごとの在庫状況を一覧表示。
  - 入出庫履歴を時系列で表示（フィルタリング機能付き）。
  - 在庫不足アラートを表示（在庫数が一定以下の場合）。
- **Update（更新）**
  - 入庫・出庫履歴の修正機能（誤入力時の対応）。
  - 在庫数の手動調整機能（例外的なケースに対応）。
- **Delete（削除）**
  - 入出庫履歴の削除（管理者権限のみ）。

### 3. ユーザー管理
- **Create（登録）**
  - 新規ユーザーの登録（管理者が行う場合と一般ユーザーが行う場合）。
  - 登録時にバリデーションを実施（メールアドレス形式、パスワード強度など）。
- **Read（表示）**
  - ユーザー一覧を表示（管理者のみアクセス可能）。
  - ユーザー詳細情報を確認可能（権限、登録日など）。
- **Update（更新）**
  - ユーザー情報の編集（名前、メールアドレス、権限など）。
  - パスワード変更機能（本人のみ実行可能）。
- **Delete（削除）**
  - ユーザーの論理削除（データベース上では削除フラグを設定）。
  - 削除済みユーザーの復元機能を追加。

### 4. 認証機能
- **ログイン**
  - Spring Securityを活用した認証機能。
  - パスワードのハッシュ化を実装。
- **ログアウト**
  - ユーザーがセッションを終了できる機能。
- **権限管理**
  - 管理者と一般ユーザーの役割分担を実現。
  - 権限に応じたアクセス制御を実装。
- **セキュリティ**
  - 多要素認証の導入を検討。

### 5. バリデーション
- **商品データ**
  - 商品名、カテゴリ、在庫数の必須入力チェック。
  - 在庫数の数値範囲チェック（例: 0以上）。
- **ユーザー入力**
  - ユーザー名、メールアドレスの形式チェック。
  - パスワードの強度チェック（例: 8文字以上、英数字混在）。
- **CSVインポート**
  - フォーマットの整合性チェック。
  - 必須項目の欠落チェック。
  - データ型のバリデーション（例: 数値項目に文字列が含まれない）。 |

| 機能カテゴリ       | 操作   | 詳細                                                                 |
|--------------------|--------|----------------------------------------------------------------------|
| **商品マスタ管理** | Create | 商品名、カテゴリ、在庫数、ステータスを入力して新規商品を登録。<br>入力フォームにバリデーションを実装（必須項目、形式チェック）。 |
|                    | Read   | 商品一覧を表示（ページネーション対応）。<br>カテゴリやステータスでのフィルタリング機能。<br>商品詳細ページで個別の商品情報を確認可能。 |
|                    | Update | 商品情報（名前、カテゴリ、在庫数、ステータス）の編集機能。<br>編集時にバリデーションを再チェック。 |
|                    | Delete | 商品の論理削除を実装（データベース上では削除フラグを設定）。<br>削除済み商品の復元機能を追加。 |
| **在庫管理**       | Create | 入庫処理：商品ごとの入庫数を登録。<br>出庫処理：商品ごとの出庫数を登録。<br>入出庫時に履歴を自動記録。 |
|                    | Read   | 商品ごとの在庫状況を一覧表示。<br>入出庫履歴を時系列で表示（フィルタリング機能付き）。<br>在庫不足アラートを表示（在庫数が一定以下の場合）。 |
|                    | Update | 入庫・出庫履歴の修正機能（誤入力時の対応）。<br>在庫数の手動調整機能（例外的なケースに対応）。 |
|                    | Delete | 入出庫履歴の削除（管理者権限のみ）。 |
| **ユーザー管理**   | Create | 新規ユーザーの登録（管理者が行う場合と一般ユーザーが行う場合）。<br>登録時にバリデーションを実施（メールアドレス形式、パスワード強度など）。 |
|                    | Read   | ユーザー一覧を表示（管理者のみアクセス可能）。<br>ユーザー詳細情報を確認可能（権限、登録日など）。 |
|                    | Update | ユーザー情報の編集（名前、メールアドレス、権限など）。<br>パスワード変更機能（本人のみ実行可能）。 |
|                    | Delete | ユーザーの論理削除（データベース上では削除フラグを設定）。<br>削除済みユーザーの復元機能を追加。 |
| **認証機能**       | ログイン | Spring Securityを活用した認証機能。<br>パスワードのハッシュ化を実装。 |
|                    | ログアウト | ユーザーがセッションを終了できる機能。 |
|                    | 権限管理 | 管理者と一般ユーザーの役割分担を実現。<br>権限に応じたアクセス制御を実装。 |
|                    | セキュリティ | 多要素認証の導入を検討。 |
| **バリデーション** | 商品データ | 商品名、カテゴリ、在庫数の必須入力チェック。<br>在庫数の数値範囲チェック（例: 0以上）。 |
|                    | ユーザー入力 | ユーザー名、メールアドレスの形式チェック。<br>パスワードの強度チェック（例: 8文字以上、英数字混在）。 |
|                    | CSVインポート | フォーマットの整合性チェック。<br>必須項目の欠落チェック。<br>データ型のバリデーション（例: 数値項目に文字列が含まれない）。 |

## 非機能要件

#### 1. 画面遷移
- **要件**:
  - 各画面間の遷移が直感的でスムーズであること。
  - ユーザーの権限に応じた画面を表示。
  - エラー発生時、適切なエラーメッセージ画面に遷移。
- **具体例**:
  - **ログイン画面**:
    - 入力成功時 → ダッシュボード画面へ遷移。
    - 入力失敗時 → 「ログインに失敗しました」と表示。
  - **ダッシュボード画面**:
    - 管理者: 管理画面（ユーザー管理、商品管理、在庫管理）へのリンクを表示。
    - 一般ユーザー: 商品一覧画面、在庫状況画面へのリンクを表示。
  - **商品一覧画面**:
    - 商品をクリック → 商品詳細画面へ遷移。
    - 編集ボタン → 商品編集画面へ遷移。
  - **エラー画面**:
    - 404エラー: 「ページが見つかりません」と表示。
    - 500エラー: 「システムエラーが発生しました」と表示。

#### 2. セキュリティ
- **要件**:
  - ユーザー認証にSpring Securityを使用。
  - パスワードはハッシュ化して保存。
  - 攻撃対策（SQLインジェクション、XSS、CSRF）。
  - HTTPS通信を使用。
  - 権限に応じたアクセス制御を実装。
- **具体例**:
  - **認証**:
    - ログイン試行回数を5回に制限。失敗時はアカウントをロック。
    - パスワードはBCryptでハッシュ化。
  - **攻撃対策**:
    - 入力値をエスケープ処理してXSSを防止。
    - CSRFトークンを使用してリクエストの正当性を確認。
    - SQLクエリはプリペアドステートメントを使用。
  - **通信**:
    - HTTPSを強制使用。
    - セッションIDを定期的に再生成。
  - **アクセス制御**:
    - 管理者のみが「ユーザー管理」画面にアクセス可能。
    - 一般ユーザーは「在庫管理」画面にアクセス不可。

#### 3. 例外処理
- **要件**:
  - システムエラーやユーザー入力エラーに対して適切なエラーメッセージを表示。
  - 予期しないエラーが発生してもシステム全体が停止しない。
  - エラー内容をログに記録。
- **具体例**:
  - **入力エラー**:
    - 必須項目が未入力 → 「この項目は必須です」と表示。
    - 数値項目に文字列が入力 → 「数値を入力してください」と表示。
  - **データベースエラー**:
    - データ取得失敗 → 「データの取得に失敗しました」と表示。
    - データ更新失敗 → 「データの更新に失敗しました」と表示。
  - **システムエラー**:
    - 予期しないエラー → 「予期しないエラーが発生しました。管理者にお問い合わせください」と表示。
  - **ログ記録**:
    - エラー発生時に以下の情報を記録:
      - 発生日時
      - エラー内容
      - 発生箇所（クラス名、メソッド名）

### 開発技術スタック
#### 開発言語
- **バックエンド**: Java 21.0.7（openjdk）
- **フロントエンド**: HTML5, CSS3, JavaScript (ES6)

#### フレームワーク・ライブラリ
- **バックエンド**: Spring Boot 3.0, Hibernate6.2
- **フロントエンド**: Bootstrap5.2, jQuery
- **ユーティリティ**: Lombok1.18, MapStruct1.5

### 動作環境
#### 本番環境(フェーズ2以降で確定するため、現時点での予定)
- **OS**: Ubuntu or RHEL 
- **Webサーバー**: Apache
- **APサーバー**: Apache Tomcat
- **データベース**: MySQL 8.0
- **クラウドサービス**: AWS EC2, S3

#### 開発環境
- **OS**: Windows 11
- **IDE**: Visual Studio Code
- **バージョン管理**: Git (GitHub)
- **AI利用**: GitCopilot

### 非機能要件の詳細
#### パフォーマンス要件
- **レスポンス時間**: サーバ側の内部処理時間は500ms以下を目標。ただし、全体のレスポンス時間は1秒以内に収める。
- **同時接続数**: 最大300ユーザーの同時接続をサポート。ただし、負荷に応じてスケーラブルな設計を採用。

#### スケーラビリティ
- **水平スケーリング**: AWS Auto Scalingを利用して負荷に応じたインスタンスの増減を実現。
- **データベース**: リードレプリカを使用して読み取り負荷を分散。

### テスト要件
#### テスト範囲
- **ユニットテスト**: 各メソッドの動作確認（JUnitを使用）。
- **統合テスト**: API間の連携確認（Spring Testを使用）。
- **システムテスト**: 全体の動作確認（Seleniumを使用）。

#### テストツール
- **バックエンド**: JUnit 5, Mockito, Spring Test
- **フロントエンド**: Selenium

### 運用・保守要件
#### ログ管理
- **保存期間**: ログは90日間保存。
- **フォーマット**: テキスト形式で保存し、可視化。

#### 保守計画
- **バックアップ**: データベースの毎日バックアップを自動化。
- **障害対応**: 障害発生時は、管理者にメール通知を送信。
